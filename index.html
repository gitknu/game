<!DOCTYPE html>
<html lang="eng">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <meta name="screen-orientation" content="landscape">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Nu, pogodi!">
    <meta property="og:title" content="Nu, pogodi! browser game."/>
    <meta property="og:image" content="https://hanka8.github.io/Nu-pogodi/assets/Screenshot.bmp" />
    <link rel="apple-touch-icon" href="https://hanka8.github.io/Nu-pogodi/assets/favicon32.png">
    <link rel="shortcut icon" href="https://hanka8.github.io/Nu-pogodi/assets/favicon32.png" type="image/x-icon">
    <title>Nu, pogodi!</title>
    <style>
        /* CODE 1: Base styles for container, buttons, and adaptiveness */
        :root {
            --multiplier: 1.8;
            --fontSize: calc(15px*var(--multiplier));
            --gameContainerWidth: calc(520px*var(--multiplier));
            --gameContainerHeight: calc(337px*var(--multiplier));
            --startBtnsBoxX: calc(446px*var(--multiplier));
            --startBtnsBoxY: calc(36px*var(--multiplier));
            --startBtnWidth: calc(24px*var(--multiplier));
            --startBtnHeight: calc(14px*var(--multiplier));
            --directionBtnWidth: calc(28px*var(--multiplier));
            --directionBtnHeight: calc(28px*var(--multiplier));
            --directionBtnOutlineWidth: calc(5px*var(--multiplier));
            --directionBtnBorderWidth: calc(2px*var(--multiplier));
            --leftTopBtnX: calc(38px*var(--multiplier));
            --leftTopBtnY: calc(176px*var(--multiplier));
            --rightTopBtnX: calc(446px*var(--multiplier));
            --rightTopBtnY: calc(176px*var(--multiplier));
            --leftBottomBtnX: calc(38px*var(--multiplier));
            --leftBottomBtnY: calc(234px*var(--multiplier));
            --rightBottomBtnX: calc(446px*var(--multiplier));
            --rightBottomBtnY: calc(234px*var(--multiplier));
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            font-family: 'Alegreya Sans SC', Tahoma, Arial, sans-serif;
        }
        .game-container {
            position: relative;
            text-align: center;
            width: var(--gameContainerWidth);
            height: var(--gameContainerHeight);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            /* FIX: Background color remains, but image is moved to an overlay */
            background-color:rgb(0, 0, 0);
        }
        /* FIX: New pseudo-element to act as the overlay */
        .game-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url(https://hanka8.github.io/Nu-pogodi/assets/game-pad-background-3.png);
            background-size: cover;
            background-repeat: no-repeat;
            z-index: 1; /* Puts the overlay above the game screen */
            pointer-events: none; /* Allows clicks to go through the overlay to the buttons */
        }
        .start-btns-box {
            position: absolute;
            left: var(--startBtnsBoxX);
            top: var(--startBtnsBoxY);
            display: flex;
            flex-direction: column;
            z-index: 2; /* Ensure buttons are on top of the overlay */
        }
        .start-btn {
            width: var(--startBtnWidth);
            height: var(--startBtnHeight);
            cursor: pointer;
            border-radius: 20px;
            border-width: calc(var(--startBtnWidth)/18);
            border-color: rgb(70, 70, 62);
            border-style: none;
            border-bottom-style: solid;
            border-left-style: solid;
            background: linear-gradient(to top right, rgb(80, 78, 78), rgb(221, 219, 219) 90%);
            outline-color: #ae1921;
            outline-style: solid;
            outline-width: calc(var(--startBtnWidth)/9);
        }
        .start-btn:hover {
            background: linear-gradient(to top right, rgb(66, 64, 64), rgb(221, 219, 219) 98%);
        }
        .start-btn:active {
            background: linear-gradient(to top right, rgb(66, 64, 64), rgb(221, 219, 219) 98%);
            border-style: solid;
            border-width: calc(var(--startBtnWidth)/20);
        }
        .start-btn-caption {
            font-size: 1.3rem;
            font-weight: bold;
            color: #000;
            margin-top: 18%;
            margin-bottom: 28%;
        }
        .direction-btn {
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            width: var(--directionBtnWidth);
            height: var(--directionBtnHeight);
            outline-width: var(--directionBtnOutlineWidth);
            outline-color: #cd222d;
            outline-style: solid;
            border-width: var(--directionBtnBorderWidth);
            border-style: solid;
            border-color: #692424;
            border-top: none;
            border-right: none;
            background: linear-gradient(to top right, #520000, #cd222d 50%, #ecdfdf 95%);
            z-index: 2; /* Ensure buttons are on top of the overlay */
        }
        .direction-btn:hover {
            background: linear-gradient(to top right, #520000, #cd222d 55%, #ecdfdf 99%);
        }
        .direction-btn:active {
            background: linear-gradient(to top right, #520000, #cd222d 55%, #ecdfdf 99%);
            border-style: solid;
            border-color: #692424;
            border-width: calc(var(--directionBtnBorderWidth)/1.5);
        }
        #leftTopBtn {
            left: var(--leftTopBtnX);
            top: var(--leftTopBtnY);
        }
        #rightTopBtn {
            left: var(--rightTopBtnX);
            top: var(--rightTopBtnY);
        }
        #leftBottomBtn {
            left: var(--leftBottomBtnX);
            top: var(--leftBottomBtnY);
        }
        #rightBottomBtn {
            left: var(--rightBottomBtnX);
            top: var(--rightBottomBtnY);
        }
        #modal {
            opacity: 0;
            position: absolute;
            inset: 0;
            top: -100%;
            transition: 300ms;
            background-color: rgba(0, 0, 0, 0.692);
            backdrop-filter: blur(5px);
            color: #faead6;
            display: block;
            width: calc(var(--gameContainerWidth) * 0.8);
            height: calc(var(--gameContainerHeight) * 0.7);
            left: 50%;
            translate: -50% 0;
            z-index: 3;
            padding: 5%;
            text-align: center;
            display: flex;
            align-items: center;
            font-size: 1rem;
        }
        #modal.shown {
            opacity: 1;
            top: 50%;
            transition: 300ms;
            translate: -50% -50%;
        }
        #modal.shown #closeModalBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 14%;
            height: 14%;
            cursor: pointer;
        }
        /* Styles for the audio control buttons */
        .audio-control-btn {
            position: fixed;
            width: var(--directionBtnWidth);
            height: var(--directionBtnHeight);
            background: linear-gradient(to top right, #520000, #cd222d 50%, #ecdfdf 95%);
            border-width: var(--directionBtnBorderWidth);
            border-style: solid;
            border-color: #692424;
            border-top: none;
            border-right: none;
            outline-width: var(--directionBtnOutlineWidth);
            outline-color: #cd222d;
            outline-style: solid;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            transition: background 0.2s;
        }
        .audio-control-btn:hover {
            background: linear-gradient(to top right, #520000, #cd222d 55%, #ecdfdf 99%);
        }
        #audioPlayBtn::after {
            content: '▶';
            font-size: calc(var(--directionBtnWidth) / 2);
            transform: translateX(10%);
        }
        #audioPlayBtn.playing::after {
            content: '❚❚';
            font-size: calc(var(--directionBtnWidth) / 2.5);
            transform: translateX(0);
        }
        #audioRestartBtn {
            display: none; /* Hidden by default */
        }
        #audioRestartBtn::after {
            content: '↺';
            font-size: calc(var(--directionBtnWidth) / 1.8);
            font-weight: bold;
        }
        #audioDownloadBtn {
            display: none; /* Hidden by default */
        }
        #audioDownloadBtn::after {
            content: '⤓'; /* Download icon */
            font-size: calc(var(--directionBtnWidth) / 1.8);
            font-weight: bold;
        }
        @media (max-width:870px) {
            .start-btn-caption {
                font-size: 1rem;
            }
        }
        @media (max-width:620px) {
            .start-btn-caption {
                font-size: 0.8rem;
            }
        }
        @media (max-width:520px) {
            .start-btn-caption {
                font-size: 0.5rem;
            }
        }
        /* CODE 2: Styles for the new game screen */
        /* FIXED: Switched to absolute positioning for more robust centering on all devices. */
        #game-wrap {
            width: 572px;
            height: 350px;
            background: transparent url('https://gitknu.github.io/game/wolf_cleanup.png') center center no-repeat;
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center center;
            z-index: 0; /* Position the game screen behind the overlay */
        }
        #game-wrap .basket {
            width: 80px;
            height: 80px;
            position: absolute;
        }
        #game-wrap[data-bx="0"][data-by="1"] .basket {
            width: 82px;
            height: 78px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/basket/basket-p-0-1.png') center center no-repeat;
            top: 158px;
            left: 126px;
        }
        #game-wrap[data-bx="1"][data-by="1"] .basket {
            width: 82px;
            height: 78px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/basket/basket-p-1-1.png') center center no-repeat;
            top: 165px;
            right: 123px;
        }
        #game-wrap[data-bx="0"][data-by="0"] .basket {
            width: 85px;
            height: 65px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/basket/basket-p-0-0.png') center center no-repeat;
            left: 124px;
            bottom: 50px;
        }
        #game-wrap[data-bx="1"][data-by="0"] .basket {
            width: 85px;
            height: 65px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/basket/basket-p-1-0.png') center center no-repeat;
            right: 126px;
            bottom: 44px;
        }
        #game-wrap .wolf {
            width: 50px;
            height: 140px;
            position: absolute;
        }
        #game-wrap[data-bx="0"] .wolf {
            width: 98px;
            height: 152px;
            top: 164px;
            left: 179px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/wolf/wolf-p-0.png') center center no-repeat;
        }
        #game-wrap[data-bx="1"] .wolf {
            width: 90px;
            height: 146px;
            top: 166px;
            right: 186px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/wolf/wolf-p-1.png') center center no-repeat;
        }
        #game-wrap .egg {
            width: 15px;
            height: 15px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/egg/egg.png') center center no-repeat;
            position: absolute;
        }
        #game-wrap[data-egg-0="0"] .egg.e-0,
        #game-wrap[data-egg-1="0"] .egg.e-1,
        #game-wrap[data-egg-2="0"] .egg.e-2,
        #game-wrap[data-egg-3="0"] .egg.e-3 {
            display: none;
        }
        #game-wrap[data-egg-0="1"] .egg.e-0 { top: 195px; left: 47px; transform: rotate(65deg); }
        #game-wrap[data-egg-0="2"] .egg.e-0 { top: 205px; left: 62px; transform: rotate(118deg); }
        #game-wrap[data-egg-0="3"] .egg.e-0 { top: 215px; left: 79px; transform: rotate(162deg); }
        #game-wrap[data-egg-0="4"] .egg.e-0 { top: 223px; left: 96px; transform: rotate(-93deg); }
        #game-wrap[data-egg-0="5"] .egg.e-0 { top: 235px; left: 108px; transform: rotate(-7deg); }
        #game-wrap[data-egg-1="1"] .egg.e-1 { top: 122px; left: 47px; transform: rotate(56deg); }
        #game-wrap[data-egg-1="2"] .egg.e-1 { top: 132px; left: 62px; transform: rotate(108deg); }
        #game-wrap[data-egg-1="3"] .egg.e-1 { top: 142px; left: 80px; transform: rotate(192deg); }
        #game-wrap[data-egg-1="4"] .egg.e-1 { top: 151px; left: 95px; transform: rotate(-62deg); }
        #game-wrap[data-egg-1="5"] .egg.e-1 { top: 160px; left: 110px; }
        #game-wrap[data-egg-2="1"] .egg.e-2 { top: 122px; right: 51px; transform: rotate(-10deg); }
        #game-wrap[data-egg-2="2"] .egg.e-2 { top: 132px; right: 66px; transform: rotate(-56deg); }
        #game-wrap[data-egg-2="3"] .egg.e-2 { top: 142px; right: 84px; transform: rotate(-128deg); }
        #game-wrap[data-egg-2="4"] .egg.e-2 { top: 149px; right: 99px; transform: rotate(140deg); }
        #game-wrap[data-egg-2="5"] .egg.e-2 { top: 160px; right: 113px; transform: rotate(58deg); }
        #game-wrap[data-egg-3="1"] .egg.e-3 { top: 195px; right: 50px; transform: rotate(-14deg); }
        #game-wrap[data-egg-3="2"] .egg.e-3 { top: 204px; right: 66px; transform: rotate(-53deg); }
        #game-wrap[data-egg-3="3"] .egg.e-3 { top: 215px; right: 83px; transform: rotate(-96deg); }
        #game-wrap[data-egg-3="4"] .egg.e-3 { top: 223px; right: 100px; transform: rotate(152deg); }
        #game-wrap[data-egg-3="5"] .egg.e-3 { top: 235px; right: 112px; transform: rotate(68deg); }
        #game-wrap #score {
            position: absolute;
            top: 48px;
            left: 326px;
        }
        #game-wrap #score ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: inline-block;
        }
        #game-wrap #score ul > li {
            width: 31px;
            height: 47px;
            margin: 0 0 0 -2px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/score/num-bg.png');
            display: inline-block;
            vertical-align: top;
        }
        #game-wrap #score ul > li span {
            width: 100%;
            height: 100%;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/score/nums.png');
            background-position: 0px 0px;
            text-indent: -200px;
            display: block;
            overflow: hidden;
        }
        #game-wrap #score ul > li.n-0 span { background-position: 0px 0px; }
        #game-wrap #score ul > li.n-1 span { background-position: -31px 0px; }
        #game-wrap #score ul > li.n-2 span { background-position: -62px 0px; }
        #game-wrap #score ul > li.n-3 span { background-position: -93px 0px; }
        #game-wrap #score ul > li.n-4 span { background-position: -124px 0px; }
        #game-wrap #score ul > li.n-5 span { background-position: -155px 0px; }
        #game-wrap #score ul > li.n-6 span { background-position: -186px 0px; }
        #game-wrap #score ul > li.n-7 span { background-position: -217px 0px; }
        #game-wrap #score ul > li.n-8 span { background-position: -248px 0px; }
        #game-wrap #score ul > li.n-9 span { background-position: -279px 0px; }
        #game-wrap #loss {
            width: 114px;
            height: 32px;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/loss/loss.png') left top no-repeat;
            position: absolute;
            top: 114px;
            left: 326px;
        }
        #game-wrap[data-loss="0"] #loss { width: 0; }
        #game-wrap[data-loss="1"] #loss { width: 40px; }
        #game-wrap[data-loss="2"] #loss { width: 80px; }
        #game-wrap[data-loss="3"] #loss { width: 120px; }
        #message {
            width: 100%;
            height: 100%;
            background: transparent url('https://shtange.github.io/catch-the-egg/img/game-over-bg.png');
            position: absolute;
            top: 0; left: 0;
            display: none;
            overflow: hidden;
            color: #E0E0D5;
        }
        #message > div {
            margin-top: 134px;
            padding: 5px 0 15px;
            background: #564E47;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3), 0 0 40px rgba(0, 0, 0, 0.1) inset;
        }
        #message > div h3 {
            font-size: 28px;
            line-height: 1.5em;
            font-weight: normal;
        }
        #message > div p {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <button id="audioPlayBtn" class="audio-control-btn"></button>
    <button id="audioRestartBtn" class="audio-control-btn"></button>
    <button id="audioDownloadBtn" class="audio-control-btn"></button>
    <audio id="backgroundAudio" src="https://gitknu.github.io/game/audio_inst.wav" loop></audio>

    <main class="game-container">
        <div class="start-btns-box">
            <button id="startBtn1" class="start-btn"></button>
            <p class="start-btn-caption">игра A</p>
            <button id="startBtn2" class="start-btn"></button>
            <p class="start-btn-caption">игра Б</p>
        </div>
        <div id="game-wrap" data-bx="0" data-by="1" data-egg-0="0" data-egg-1="0" data-egg-2="0" data-egg-3="0" data-loss="0">
            <div class="basket"></div>
            <div class="wolf"></div>
            <div class="egg e-0"></div>
            <div class="egg e-1"></div>
            <div class="egg e-2"></div>
            <div class="egg e-3"></div>
            <div id="score">
                <ul>
                    <li class="n-0"><span>0</span></li>
                    <li class="n-0"><span>0</span></li>
                    <li class="n-0"><span>0</span></li>
                    <li class="n-0"><span>0</span></li>
                </ul>
            </div>
            <div id="loss"></div>
            <div id="message"></div>
        </div>
        <button id="leftTopBtn" class="direction-btn"></button>
        <button id="leftBottomBtn" class="direction-btn"></button>
        <button id="rightTopBtn" class="direction-btn"></button>
        <button id="rightBottomBtn" class="direction-btn"></button>
    </main>
    <div id="modal">
        <p>Будь ласка, увімкніть авто-поворот та поверніть телефон горизонтально. Дякую!</p>
        <img id="closeModalBtn" src="https://hanka8.github.io/Nu-pogodi/assets/close.svg" alt="close">
    </div>
    <script>
        // --- DOM ELEMENTS ---
        const gameContainerElement = document.querySelector('.game-container');
        const gameWrapElement = document.getElementById("game-wrap");
        const scoreListElement = document.querySelector("#score ul");
        const modalElement = document.getElementById("modal");
        const startBtn1 = document.getElementById("startBtn1");
        const startBtn2 = document.getElementById("startBtn2");
        const leftTopBtn = document.getElementById("leftTopBtn");
        const leftBottomBtn = document.getElementById("leftBottomBtn");
        const rightTopBtn = document.getElementById("rightTopBtn");
        const rightBottomBtn = document.getElementById("rightBottomBtn");
        const closeModalBtn = document.getElementById("closeModalBtn");
        // Audio elements
        const audioPlayBtn = document.getElementById("audioPlayBtn");
        const audioRestartBtn = document.getElementById("audioRestartBtn");
        const audioDownloadBtn = document.getElementById("audioDownloadBtn");
        const backgroundAudio = document.getElementById("backgroundAudio");
        backgroundAudio.volume = 0.1; // Set background audio volume to 10%
        let hasAudioBeenPlayed = false; // Flag to track if audio has started

        // --- GAME CONSTANTS ---
        const EGG_FREQUENCY_CHANGE_A = 250;
        const EGG_SPEED_CHANGE_A = 50;
        const EGG_FREQUENCY_CHANGE_B = 300;
        const EGG_SPEED_CHANGE_B = 60;
        const MAX_MULTIPLIER = 1.8;
        const ORIGINAL_GAME_WRAP_WIDTH = 572;
        // --- GAME LOGIC ---
        class Game {
            constructor() {
                this.score = 0;
                this.lives = 0;
                this.eggFrequency = 3000;
                this.eggSpeed = 4000;
                this.wolf = new Wolf();
                this.isEnded = false;
                this.gameStarted = false;
                this.previousEggState = "";
                this.gameType = "A";
                this.intervalId = null;
            }
            start() {
                this.intervalId = setInterval(() => {
                    if (this.isEnded) {
                        clearInterval(this.intervalId);
                        return;
                    }
                    const egg = new Egg();
                    egg.fall();
                    if (this.score % 100 == 0 && this.score > 0) {
                        // Bonus life could be implemented here
                    }
                    if (this.score > 0 && this.score % 10 == 0 && this.eggFrequency >= 800 && this.eggSpeed >= 500) {
                        if (this.gameType == "A") {
                            this.eggFrequency -= EGG_FREQUENCY_CHANGE_A;
                            this.eggSpeed -= EGG_SPEED_CHANGE_A;
                        } else {
                            this.eggFrequency -= EGG_FREQUENCY_CHANGE_B;
                            this.eggSpeed -= EGG_SPEED_CHANGE_B;
                        }
                    }
                }, this.eggFrequency);
            }
            end() {
                this.isEnded = true;
                let gameOverSound = new Audio("https://hanka8.github.io/Nu-pogodi/sounds/gameOver.mp3");
                gameOverSound.play();
                const messageWrap = document.getElementById("message");
                messageWrap.innerHTML = '';
                const messageDiv = document.createElement('div');
                const h3 = document.createElement('h3');
                h3.textContent = 'Game Over';
                const p = document.createElement('p');
                p.innerHTML = 'Press GAME A or GAME B to restart';
                messageDiv.appendChild(h3);
                messageDiv.appendChild(p);
                messageWrap.appendChild(messageDiv);
                messageWrap.style.display = 'block';
            }
            updateScore() {
                this.score += 1;
                let collectSound = new Audio("https://hanka8.github.io/Nu-pogodi/sounds/collect.mp3");
                collectSound.play();
                const scoreString = this.score.toString().padStart(4, '0');
                const scoreElements = scoreListElement.getElementsByTagName('li');
                for (let i = 0; i < scoreElements.length; i++) {
                    scoreElements[i].className = 'n-' + scoreString[i];
                }
            }
            updateLives() {
                this.lives += 1;
                if (this.lives <= 3) {
                    let lifeSound = new Audio("https://hanka8.github.io/Nu-pogodi/sounds/lifeDown.mp3");
                    lifeSound.play();
                    gameWrapElement.setAttribute('data-loss', this.lives);
                }
                if (this.lives >= 3) {
                    this.end();
                }
            }
        }
        class Wolf {
            constructor() {
                this.x = 0;
                this.y = 1;
                this.updatePosition();
            }
            updatePosition() {
                gameWrapElement.setAttribute('data-bx', this.x);
                gameWrapElement.setAttribute('data-by', this.y);
            }
            moveLeft() { this.x = 0; }
            moveRight() { this.x = 1; }
            moveUp() { this.y = 1; }
            moveDown() { this.y = 0; }
            checkCollision(egg) {
                let eggIsLeft = egg.state.includes('left');
                let eggIsTop = egg.state.includes('top');
                let eggX = eggIsLeft ? 0 : 1;
                let eggY = eggIsTop ? 1 : 0;
                if (this.x === eggX && this.y === eggY) {
                    game.updateScore();
                } else {
                    game.updateLives();
                }
            }
        }
        class Egg {
            constructor() {
                let eggOptions = ["bottom-left", "top-left", "top-right", "bottom-right"];
                this.state = eggOptions[Math.floor(Math.random() * eggOptions.length)];
                while (this.state === game.previousEggState) {
                    this.state = eggOptions[Math.floor(Math.random() * eggOptions.length)];
                }
                game.previousEggState = this.state;
                const stateMap = { "bottom-left": 0, "top-left": 1, "top-right": 2, "bottom-right": 3 };
                this.eggIndex = stateMap[this.state];
                this.step = 0;
                this.maxSteps = 5;
            }
            fall() {
                const self = this;
                const interval = setInterval(() => {
                    if (game.isEnded) {
                        clearInterval(interval);
                        gameWrapElement.setAttribute('data-egg-' + self.eggIndex, 0);
                        return;
                    }
                    self.step++;
                    gameWrapElement.setAttribute('data-egg-' + self.eggIndex, self.step);
                    if (self.step > self.maxSteps) {
                        clearInterval(interval);
                        gameWrapElement.setAttribute('data-egg-' + self.eggIndex, 0);
                        game.wolf.checkCollision(self);
                    }
                }, game.eggSpeed / (this.maxSteps + 1));
            }
        }
        // --- INITIALIZE GAME and EVENT LISTENERS ---
        const game = new Game();
        function handleMove(moveFn1, moveFn2) {
            if (game.isEnded) return;
            if (!game.gameStarted) {
                game.start();
                game.gameStarted = true;
            }
            moveFn1.call(game.wolf);
            moveFn2.call(game.wolf);
            game.wolf.updatePosition();
        }
        leftBottomBtn.addEventListener("click", () => handleMove(game.wolf.moveLeft, game.wolf.moveDown));
        leftTopBtn.addEventListener("click", () => handleMove(game.wolf.moveLeft, game.wolf.moveUp));
        rightBottomBtn.addEventListener("click", () => handleMove(game.wolf.moveRight, game.wolf.moveDown));
        rightTopBtn.addEventListener("click", () => handleMove(game.wolf.moveRight, game.wolf.moveUp));
        startBtn1.addEventListener("click", () => {
            if (game.isEnded) {
                location.reload();
            }
            if (!game.gameStarted) {
                game.start();
                game.gameStarted = true;
                game.gameType = "A";
            }
        });
        startBtn2.addEventListener("click", () => {
            if (game.isEnded) {
                location.reload();
            }
            if (!game.gameStarted) {
                game.eggSpeed = 3000;
                game.eggFrequency = 2500;
                game.start();
                game.gameStarted = true;
                game.gameType = "B";
            }
        });
        // Event listeners for the audio control buttons
        audioPlayBtn.addEventListener("click", () => {
            if (!hasAudioBeenPlayed) {
                audioRestartBtn.style.display = 'flex';
                audioDownloadBtn.style.display = 'flex';
                hasAudioBeenPlayed = true;
            }
            if (backgroundAudio.paused) {
                backgroundAudio.play();
                audioPlayBtn.classList.add('playing');
            } else {
                backgroundAudio.pause();
                audioPlayBtn.classList.remove('playing');
            }
        });
        audioRestartBtn.addEventListener("click", () => {
            backgroundAudio.currentTime = 0;
            if (backgroundAudio.paused) {
                backgroundAudio.play();
                audioPlayBtn.classList.add('playing');
            }
        });
        audioDownloadBtn.addEventListener("click", () => {
            const link = document.createElement('a');
            link.href = backgroundAudio.src;
            link.download = 'Nu-pogodi-music.wav'; // The filename for the downloaded file
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        // --- RESPONSIVENESS AND ADAPTIVENESS ---
        function responsibility() {
            // This part scales the outer console to fit the browser window
            const { innerWidth: windowWidth, innerHeight: windowHeight } = window;
            const regex = /\((.*?)px/;
            const containerHeightString = getComputedStyle(document.documentElement).getPropertyValue("--gameContainerHeight");
            const containerWidthString = getComputedStyle(document.documentElement).getPropertyValue("--gameContainerWidth");
            const containerHeight = parseInt(containerHeightString.match(regex)[1]);
            const containerWidth = parseInt(containerWidthString.match(regex)[1]);
            const newMultiplierBasedOnHeight = Math.min(windowHeight / containerHeight, MAX_MULTIPLIER);
            const newMultiplierBasedOnWidth = Math.min(windowWidth / containerWidth, MAX_MULTIPLIER);
            const isNarrow = windowWidth / windowHeight < 1.6;
            let newMultiplier;
            if (windowWidth < 2400) {
                newMultiplier = isNarrow ? newMultiplierBasedOnWidth / 1.1 : newMultiplierBasedOnHeight;
            } else {
                newMultiplier = MAX_MULTIPLIER;
            }
            document.documentElement.style.setProperty("--multiplier", `${newMultiplier}`);
            // This part scales the inner game screen to fit the console's width
            const targetGameWidth = gameContainerElement.offsetWidth * (255 / 520);
            const scaleFactor = targetGameWidth / ORIGINAL_GAME_WRAP_WIDTH;
            // FIXED: Added translate(-50%, -50%) to ensure the game screen stays centered when scaled.
            gameWrapElement.style.transform = `translate(-50%, -50%) scale(${scaleFactor})`;

            // --- CORRECTED BUTTON POSITIONING LOGIC ---
            const consoleRect = gameContainerElement.getBoundingClientRect();
            const midpointOfRightSpace = (consoleRect.right + windowWidth) / 2;
            const buttonRect = audioPlayBtn.getBoundingClientRect();
            const buttonWidth = buttonRect.width;
            const buttonHeight = buttonRect.height;
            const buttonLeftPosition = midpointOfRightSpace - (buttonWidth / 2);
            
            // The vertical gap between buttons will be the same as the gap from the top of the viewport
            const topGap = consoleRect.top;

            // Position the first button (Play)
            const playBtnTop = topGap;
            audioPlayBtn.style.left = `${buttonLeftPosition}px`;
            audioPlayBtn.style.top = `${playBtnTop}px`;

            // Position the second button (Restart) below the first
            const restartBtnTop = playBtnTop + buttonHeight + topGap;
            audioRestartBtn.style.left = `${buttonLeftPosition}px`;
            audioRestartBtn.style.top = `${restartBtnTop}px`;

            // Position the third button (Download) below the second
            const downloadBtnTop = restartBtnTop + buttonHeight + topGap;
            audioDownloadBtn.style.left = `${buttonLeftPosition}px`;
            audioDownloadBtn.style.top = `${downloadBtnTop}px`;
        }
        function pleaseRotate() {
            if (window.screen.width <= 700) {
                if (window.screen.orientation.type === "portrait-primary" || window.screen.orientation.type === "portrait-secondary") {
                    modalElement.classList.add("shown");
                } else {
                    modalElement.classList.remove("shown");
                }
            }
        }
        closeModalBtn.addEventListener("click", () => {
            modalElement.classList.remove("shown");
        });
        window.addEventListener("resize", () => {
            responsibility();
            pleaseRotate();
        });
        window.addEventListener("load", () => {
            responsibility();
            pleaseRotate();
        });
    </script>
</body>
</html>
